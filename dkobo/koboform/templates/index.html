<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    {% load compress %}
    {% load staticfiles %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>KoBoToolbox</title>

    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="{{csrf_token}}">

    <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}" />
    <!-- iPhone + iPad icons -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="{% static 'img/apple-touch-icon-114x114.png' %}">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="{% static 'img/apple-touch-icon-72x72-precomposed.png' %}">
    <link rel="apple-touch-icon-precomposed" href="{% static 'img/apple-touch-icon-precomposed.png' %}">
    <link rel="apple-touch-icon" href="{% static 'img/apple-touch-icon.png' %}">

    {% compress css %}
    <link rel="stylesheet" href="{% static 'css/jquery-ui-1.10.4.custom.css' %}">
    <link rel="stylesheet" href="{% static 'components/fontawesome/css/font-awesome.css' %}" media="all">
    <link rel="stylesheet" href="{% static 'components/angular-ui-select/dist/select.css' %}" media="all">
    <link rel="stylesheet" href="{% static 'components/jquery.tagsinput/jquery.tagsinput.css' %}" media="all">
    <link rel="stylesheet" href="{% static 'kobo.compiled/kobo.css' %}" media="all">

    {% endcompress %}

    <script src="{% static 'kobo.compiled/modernizr.js' %}"></script>

    <script src="{% static 'components/jquery/dist/jquery.js' %}"></script>

    {% compress js %}
      <script src="{% static 'components/jquery-migrate/jquery-migrate.js' %}"></script>
      <script src="{% static 'components/underscore/underscore.js' %}"></script>
      <script src="{% static 'components/backbone/backbone.js' %}"></script>
      <script src="{% static 'js/jquery.poshytip.js' %}"></script>
      <script src="{% static 'components/x-editable/dist/jquery-editable/js/jquery-editable-poshytip.js' %}"></script>
    {% endcompress %}

    {% if livereload_address %}
    <script src="{{livereload_address}}"></script>
    {% endif %}

    <script type="text/javascript" charset="utf-8">
    window.staticFilesUri = "{% static 'kobo/' %}";
    </script>
    <script type="text/javascript">
      window.userDetails = {{user_details|safe}};
      window.koboConfigs = {{page_kobo_configs|safe}};
      $.fn.editable.defaults.mode = 'inline';
      $.fn.editable.defaults.onblur = 'submit';
      $.fn.editable.defaults.showbuttons = false;
    </script>

    {% compress js %}
      <script src="{% static 'js/log.coffee' %}" type="text/coffeescript"></script>
      <script src="{% static 'components/angular/angular.js' %}"></script>
      <script src="{% static 'components/angular-sanitize/angular-sanitize.min.js' %}"></script>
      <script src="{% static 'components/angular-cookies/angular-cookies.js' %}"></script>
      <script src="{% static 'components/angular-mocks/angular-mocks.js' %}"></script>
      <script src="{% static 'components/angular-resource/angular-resource.js' %}"></script>
      <script src="{% static 'components/angular-route/angular-route.js' %}"></script>
      <script src="{% static 'components/angular-ui-utils/ui-utils.js' %}"></script>
      <script src="{% static 'components/select2/select2.js' %}"></script>

      <script src="{% static 'components/jquery.scrollTo/jquery.scrollTo.js' %}"></script>
      <script src="{% static 'js/Backbone.Validation.js' %}"></script>
    {% endcompress %}
      <script src="{% static 'components/angular-ui-select/dist/select.js' %}"></script>
      <script src="{% static 'components/jquery.tagsinput/jquery.tagsinput.min.js' %}"></script>
    {% compress js %}
      <script src="{% static 'js/modal.js' %}"></script>
      <script src="{% static 'js/jquery-ui-1.10.4.custom.js' %}"></script>
      <script src="{% static 'components/jquery-ui-touch-punch-improved/jquery.ui.touch-punch-improved.js' %}"></script>

      {# ---------------------- File Upload --------------------------- #}
      <script src="{% static 'js/vendor/jquery.ui.widget.js' %}"></script>
      <script src="{% static 'js/jquery.iframe-transport.js' %}"></script>
      <script src="{% static 'js/jquery.fileupload.js' %}"></script>
      <script src="{% static 'js/jquery.fileupload-angular.js' %}"></script>
      {# -------------------------------------------------------------- #}

    {% endcompress %}

    <script src="{% static 'kobo.compiled/dkobo_xlform.js' %}"></script>


    {% compress js %}

    <script src="{% static 'kobo/app.js' %}"></script>
    <script src="{% static 'kobo/directives/OutsideClick.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/QuestionLibrary.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/TopLevelMenu.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/KobocatFormPublisher.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/InfoList.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/ItemList.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/InnerTransclude.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/QuestionDetails.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/FocusOn.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/ItemFilters.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/AddNewTag.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/Tags.Directive.js' %}"></script>
    <script src="{% static 'kobo/directives/InfiniteScroll.Directive.js' %}"></script>
    <script src="{% static 'kobo/factories/UserDetails.Factory.js' %}"></script>
    <script src="{% static 'kobo/factories/restApi.Factory.js' %}"></script>
    <script src="{% static 'kobo/filters/Titlecase.Filter.js' %}"></script>
    <script src="{% static 'kobo/filters/Item.Filter.js' %}"></script>
    <script src="{% static 'kobo/services/RouteTo.Service.js' %}"></script>
    <script src="{% static 'kobo/services/MiscUtils.Service.js' %}"></script>
    <script src="{% static 'kobo/services/Configuration.Service.js' %}"></script>
    <script src="{% static 'kobo/services/Api.Service.js' %}"></script>
    <script src="{% static 'kobo/controllers/Builder.Controller.js' %}"></script>
    <script src="{% static 'kobo/controllers/Header.Controller.js' %}"></script>
    <script src="{% static 'kobo/controllers/Forms.Controller.js' %}"></script>
    <script src="{% static 'kobo/controllers/Assets.Controller.js' %}"></script>
    <script src="{% static 'kobo/controllers/AssetEditor.Controller.js' %}"></script>
    <script src="{% static 'kobo/controllers/Import.Controller.js' %}"></script>
    <script src="{% static 'kobo/app_run.js' %}"></script>

    {% endcompress %}

  </head>

  <body ng-app="dkobo">
  {%verbatim %}

    <section top-level-menu class="top-level-menu" active-tab="activeTab" ng-class="topLevelMenuActive"></section>
    <main class="main" ng-click="closeTopMenu()">
      <header class="header-bar" ng-controller="HeaderController" ng-click="closeTopMenu()">
        <div class="container__wide">
          <span class="header-bar__top-level-menu-button">
            <i class="fa fa-bars fa-lg fa-inverse" ng-click="toggleTopMenu($event)"></i>
          </span>
          <h1 class="header-bar__title">
            <a href="#/{{icon_link}}">
              <span class="header-bar__title-text">{{ activeTab }}</span>
            </a>
          </h1>
            <span class="header-bar__top-logo pull-right" ng-click="toggleBleedingEdge($event)"></span>
            <a href="http://support.kobotoolbox.org/" class="header-bar__support pull-right" target="_blank" title="Visit our self-help pages or ask a support question (opens in new tab)">Support</a>
        </div>
      </header>

      <section ng-view class="content" ng-class="additionalClasses"></section>
      <div class="alert-modal"></div>
    </main>

  {% endverbatim %}

  {% if trackjs_token %}
  <script type="text/javascript">

  window._trackJs = {};
  if (window.userDetails && window.userDetails.username) {
    _trackJs.userId = window.userDetails.username;
  }

  </script>
  <script type="text/javascript" src="//d2zah9y47r7bi2.cloudfront.net/releases/current/tracker.js"
    data-token="{{trackjs_token}}"></script>
  {% endif %}
  {% if google_analytics_token %}
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', '{{google_analytics_token}}', 'auto');
    ga('send', 'pageview');
  </script>
  {% endif %}

  </body>
</html>
